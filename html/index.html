<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div id="chart" style="width: 100%"></div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>
    <script>

    // 3. This function fires when Google Charts has been fully loaded
    function drawChart() {

      // 4. Retrieve the raw JSON data
    var autobahn = require('autobahn');
    var wsuri = "wss://api.poloniex.com";
    var connection = new autobahn.Connection({
      url: wsuri,
      realm: "realm1"
    });
    connection.onopen = function (session) {

        // 5. Create a new DataTable (Charts expects data in this format)
        var data = new google.visualization.DataTable();

        // 6. Add two columns to the DataTable
        data.addColumn('datetime', 'Time');
        data.addColumn('number',   'Temp');

        // 7. Cycle through the records, adding one row per record
        function marketEvent(args, kwargs) {
          data.addRow([
              (args[0]),
              parseFloat(args[1])
            ]);
        };

        session.subscribe('ticker', marketEvent);
        connection.onclose = function () {
          console.log("Websocket connection closed");
        }
                       
        connection.open();
        // 8. Create a new line chart
        var chart = new google.visualization.LineChart($('#chart').get(0));

        // 9. Render the chart, passing in our DataTable and any config data
        chart.draw(data, {
          title:  'Ambient Temperature (/test/temp)',
          height: 150
        });

      };

    }

    // 1. Start loading Google Charts
    google.load('visualization', '1', {
      packages: ['corechart']
    });

    // 2. Set a callback function to fire when loading is complete
    google.setOnLoadCallback(drawChart);

    </script>
  </body>
</html>